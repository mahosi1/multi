<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 15px;
        }
    </style>

</head>


<body>
    <div class="row">
        <div class="col-1" style="border: 1px;">
            <button onclick="setRand(1);">rando 1</button>
        </div>
        <div class="col-1">
            <button onclick="setRand(2);">rando 2</button>
        </div>
        <div class="col-1">
            <button onclick="setRand(3);">rando 3</button>
        </div>
        <div class="col-1">
            <button onclick="setRand(4);">rando 4</button>
        </div>
        <div class="col-1">
            <button onclick="setRand(5);">rando 5</button>
        </div>
    </div>


    <div class="row">
        <div class="col-1">
            <input type="number" id="a1" maxlength="10" class="form-control">
        </div>
    </div>

    <div class="row">
        <div class="col-1">
            <input type="number" id="a2" maxlength="10" class="form-control">
        </div>
    </div>




    <hr style="width:120px; margin: 0px;">

    <input type="submit" style="margin-top: 30px;" value="Calculate" onclick="calculate()" />

    <div id="problem" style="margin-top: 30px;">
    </div>

    <div id="carry" style="margin-top: 30px;">
    </div>


    <div id="work" style="margin-top: 5px;">
    </div>


    <div id="results" style="margin-top: 30px;">
    </div>

    <script type="text/javascript">

        function setRand(num) {
            document.getElementById("a1").value = rand(num);
            document.getElementById("a2").value = rand(num);
        }

        function rand(num) {
            var s = '';
            var k = '';
            while (s.length < num) {
                k = '';
                if (s === '') {
                    k = (Math.floor(Math.random() * 9) + 1).toString();
                } else {
                    k = (Math.floor(Math.random() * 9)).toString();
                }

                if (!s.includes(k))
                    s += k;

            }
            return parseInt(s, 10);
        }


        function addTable(tagName, table) {
            var divTag = document.getElementById(tagName);
            divTag.innerHTML = "";
            divTag.appendChild(table);
        }

        function calculate() {
            var firstNumber = document.getElementById("a1").value;
            var secondNumber = document.getElementById("a2").value;


            var table = makeTable();
            addTable("problem", table);




            var cells = (parseInt(firstNumber, 10) * parseInt(secondNumber, 10)).toString().length;

            loadTable(firstNumber, table, cells);

            loadTable(secondNumber, table, cells);


            table = makeTable();
            addTable("work", table);


            var lines = [];

            var num1 = parseInt(firstNumber, 10);
            var reversed = reverseString(secondNumber);
            for (var i = 0; i < reversed.length; i++) {
                var theNum = parseInt(reversed[i], 10);
                theNum = Math.pow(10, i) * theNum;
                var val = (theNum * num1).toString();
                lines.push(val);
                if (val === "0") {
                    var pad = num1.toString().length + i + 1;
                    val = val.padStart(pad, '0');
                }
                loadTable(val, table, cells);
            }



            table = makeTable();
            addTable("results", table);



            loadTable((parseInt(firstNumber, 10) * parseInt(secondNumber, 10)).toString(), table);

            //4157
            //2581


            table = makeTable();
            table.style.backgroundColor = "DarkRed";
            table.style.color = "White";

            addTable("carry", table);




            // just 0 pad the multiplication lines
            var max = lines[0].length;
            for (i = 1; i < lines.length; i++) {
                if (lines[i].length > max) {
                    max = lines[i].length
                };
            }

            for (i = 0; i < lines.length; i++) {
                lines[i] = lines[i].padStart(max, '0');
            }



            var sumsByPosition = [];

            for (i = max - 1; i >= 0; i--) {
                var sum = 0;
                for (j = 0; j < lines.length; j++) {
                    sum += parseInt(lines[j][i], 0)
                }
                sumsByPosition.push(sum);
            }

            var carriesByPosition = [];
            var carry = 0;
            for (i = 0; i < sumsByPosition.length; i++) {
                carriesByPosition.unshift(carry);
                var value = sumsByPosition[i] + carry;
                carry = 0;
                if (i === 0) {
                    if (value > 10) {
                        carry = 1;
                    }
                } else {
                    carry = parseInt(value / 10);
                }
            }

            // do we have a carry in the last spot
            if (carry > 0) {
                carriesByPosition.unshift(carry);
            }

            loadTable(carriesByPosition, table);


        }


        function makeTable() {
            var table = document.createElement("TABLE");
            table.border = "1";
            table.classList.add("table");
            table.classList.add("table-bordered");
            return table;

        }


        function loadTable(num, table, spots) {
            var theNumbers = new Array();

            var tmp = [];
            if (spots) {
                var delta = spots - num.toString().length;
                for (var j = 0; j < delta; j++) {
                    tmp.push('&nbsp;&nbsp;');
                }
            }
            for (var i = 0; i < num.length; i++) {
                tmp.push(num[i]);
            }
            theNumbers.push(tmp);


            var columnCount = theNumbers[0].length;

            var row = table.insertRow(-1);
            for (var i = 0; i < columnCount; i++) {
                var headerCell = document.createElement("TH");
                headerCell.innerHTML = theNumbers[0][i];

                row.appendChild(headerCell);
            }
        }

        function reverseString(str) {
            var newString = "";
            for (var i = str.length - 1; i >= 0; i--) {
                newString += str[i];
            }
            return newString;
        }

    </script>
</body>

</html>
